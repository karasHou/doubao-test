<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½èœè°±ä¸é£Ÿæç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #f5f5f5; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem 0; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        header h1 { text-align: center; font-size: 2rem; }
        .nav-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 2rem; flex-wrap: wrap; }
        .nav-btn { padding: 0.75rem 1.5rem; background: #e2e8f0; color: #4a5568; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; }
        .nav-btn.active { background: #667eea; color: white; }
        .nav-btn:hover { transform: translateY(-2px); }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        .card { background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .item-card { background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .item-card:hover { transform: translateY(-4px); }
        .expired { background: #fed7d7; border: 1px solid #fc8181; }
        .expiring { background: #feebc8; border: 1px solid #f6ad55; }
        .btn { padding: 0.5rem 1rem; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 0.25rem; transition: all 0.3s ease; }
        .btn:hover { background: #5568d3; }
        .btn-danger { background: #f56565; }
        .btn-danger:hover { background: #e53e3e; }
        .btn-secondary { background: #718096; }
        .form-group { margin: 0.75rem 0; display: flex; flex-direction: column; gap: 0.5rem; }
        .form-group label { font-weight: 600; }
        .form-group input, .form-group select { padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 1rem; }
        .filter-group { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @media (max-width: 768px) {
            header h1 { font-size: 1.5rem; }
            .grid { grid-template-columns: 1fr; }
            .filter-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ³ æ™ºèƒ½èœè°±ä¸é£Ÿæç®¡ç†ç³»ç»Ÿ</h1>
        </div>
    </header>

    <nav class="container">
        <div class="nav-tabs">
            <button class="nav-btn active" onclick="showTab('ingredients')">ğŸ¥¬ é£Ÿæç®¡ç†</button>
            <button class="nav-btn" onclick="showTab('recipes')">ğŸ“ èœè°±æ¨è</button>
            <button class="nav-btn" onclick="showTab('expired')">âš ï¸ è¿‡æœŸæé†’</button>
        </div>
    </nav>

    <div class="container">
        <!-- é£Ÿæç®¡ç† -->
        <div class="tab-content active" id="ingredients">
            <div class="card">
                <h2>æ·»åŠ æ–°é£Ÿæ</h2>
                <form onsubmit="addIngredient(event)">
                    <div class="form-group">
                        <label>åç§°:</label>
                        <input type="text" id="ing-name" required>
                    </div>
                    <div class="form-group">
                        <label>æ•°é‡:</label>
                        <input type="number" id="ing-qty" min="0" step="0.1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label>å•ä½:</label>
                        <input type="text" id="ing-unit" required>
                    </div>
                    <div class="form-group">
                        <label>è¿‡æœŸæ—¥æœŸ:</label>
                        <input type="date" id="ing-exp" required>
                    </div>
                    <div class="form-group">
                        <label>åˆ†ç±»:</label>
                        <select id="ing-cat">
                            <option value="">é€‰æ‹©åˆ†ç±»</option>
                            <option value="è”¬èœ">è”¬èœ</option>
                            <option value="æ°´æœ">æ°´æœ</option>
                            <option value="è‚‰ç±»">è‚‰ç±»</option>
                            <option value="æµ·é²œ">æµ·é²œ</option>
                            <option value="è°·ç‰©">è°·ç‰©</option>
                            <option value="ä¹³åˆ¶å“">ä¹³åˆ¶å“</option>
                            <option value="è°ƒæ–™">è°ƒæ–™</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">æ·»åŠ é£Ÿæ</button>
                </form>
            </div>

            <h2>ç°æœ‰é£Ÿæ</h2>
            <div id="ingredients-list" class="grid"></div>
        </div>

        <!-- èœè°±æ¨è -->
        <div class="tab-content" id="recipes">
            <div class="card">
                <h2>ç­›é€‰èœè°±</h2>
                <div class="filter-group">
                    <div class="form-group">
                        <label>éš¾åº¦:</label>
                        <select id="recipe-difficulty" onchange="loadRecipes()">
                            <option value="">æ‰€æœ‰éš¾åº¦</option>
                            <option value="ç®€å•">ç®€å•</option>
                            <option value="ä¸­ç­‰">ä¸­ç­‰</option>
                            <option value="å›°éš¾">å›°éš¾</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>çƒ¹é¥ªæ—¶é—´:</label>
                        <select id="recipe-time" onchange="loadRecipes()">
                            <option value="">æ‰€æœ‰æ—¶é—´</option>
                            <option value="15">15åˆ†é’Ÿ</option>
                            <option value="30">30åˆ†é’Ÿ</option>
                            <option value="60">60åˆ†é’Ÿ</option>
                        </select>
                    </div>
                </div>
            </div>

            <h2>ä¸ºæ‚¨æ¨èçš„èœè°±</h2>
            <div id="recommendations-list" class="grid"></div>

            <h2>æ‰€æœ‰èœè°±</h2>
            <div id="all-recipes-list" class="grid"></div>
        </div>

        <!-- è¿‡æœŸæé†’ -->
        <div class="tab-content" id="expired">
            <div class="card">
                <h2>å·²è¿‡æœŸé£Ÿæ</h2>
                <div id="expired-ingredients" class="grid"></div>
            </div>

            <div class="card">
                <h2>å³å°†è¿‡æœŸé£Ÿæ (3å¤©å†…)</h2>
                <div id="expiring-ingredients" class="grid"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3004/api';

        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');

            if (tab === 'ingredients') loadIngredients();
            if (tab === 'recipes') loadRecipes();
            if (tab === 'expired') loadExpiredIngredients();
        }

        async function loadIngredients() {
            const res = await fetch(API_BASE + '/ingredients');
            const data = await res.json();
            const list = document.getElementById('ingredients-list');
            list.innerHTML = data.map(ing => `
                <div class="item-card ${ing.is_expired ? 'expired' : ''}">
                    <h3>${ing.name}</h3>
                    <p>æ•°é‡: ${ing.quantity} ${ing.unit}</p>
                    <p>è¿‡æœŸ: ${ing.expiration_date}</p>
                    <p>åˆ†ç±»: ${ing.category?.name || 'æœªåˆ†ç±»'}</p>
                    ${ing.is_expired ? '<p style="color:red">âš ï¸ å·²è¿‡æœŸ</p>' : ''}
                    <button class="btn btn-danger" onclick="deleteIngredient('${ing.id}')">åˆ é™¤</button>
                </div>
            `).join('');
        }

        async function addIngredient(e) {
            e.preventDefault();
            const data = {
                name: document.getElementById('ing-name').value,
                quantity: parseFloat(document.getElementById('ing-qty').value),
                unit: document.getElementById('ing-unit').value,
                expiration_date: document.getElementById('ing-exp').value,
                category: { name: document.getElementById('ing-cat').value }
            };

            await fetch(API_BASE + '/ingredients', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            loadIngredients();
            e.target.reset();
        }

        async function deleteIngredient(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé£Ÿæå—ï¼Ÿ')) {
                await fetch(API_BASE + '/ingredients/' + id, { method: 'DELETE' });
                loadIngredients();
            }
        }

        async function loadRecipes() {
            const difficulty = document.getElementById('recipe-difficulty').value;
            const maxTime = document.getElementById('recipe-time').value;
            const query = new URLSearchParams();
            if (difficulty) query.append('difficulty', difficulty);
            if (maxTime) query.append('max_cooking_time', maxTime);

            const res = await fetch(API_BASE + '/recommendations');
            const recData = await res.json();

            const recList = document.getElementById('recommendations-list');
            recList.innerHTML = recData.recipes.map(recipe => `
                <div class="item-card">
                    <h3>${recipe.name}</h3>
                    <p>${recipe.description}</p>
                    <p>â±ï¸ ${recipe.cooking_time}åˆ†é’Ÿ | éš¾åº¦: ${recipe.difficulty}</p>
                    <p>ğŸ“– æ ‡ç­¾: ${recipe.tags.map(t => t.tag).join(', ')}</p>
                    <details>
                        <summary>é£Ÿæå’Œæ­¥éª¤</summary>
                        <p><strong>é£Ÿæ:</strong></p>
                        <ul>
                            ${recipe.ingredients.map(ri => `<li>${ri.ingredient_name}: ${ri.quantity} ${ri.unit}</li>`).join('')}
                        </ul>
                        <p><strong>æ­¥éª¤:</strong></p>
                        <pre>${recipe.instructions}</pre>
                    </details>
                </div>
            `).join('');

            const allRes = await fetch(`${API_BASE}/recipes?${query}`);
            const allData = await allRes.json();

            const allList = document.getElementById('all-recipes-list');
            allList.innerHTML = allData.map(recipe => `
                <div class="item-card">
                    <h3>${recipe.name}</h3>
                    <p>â±ï¸ ${recipe.cooking_time}åˆ†é’Ÿ | éš¾åº¦: ${recipe.difficulty}</p>
                </div>
            `).join('');
        }

        async function loadExpiredIngredients() {
            const expired = await fetch(API_BASE + '/ingredients/status/expired').then(r => r.json());
            const expiring = await fetch(API_BASE + '/ingredients/status/expiring-soon').then(r => r.json());

            document.getElementById('expired-ingredients').innerHTML = expired.map(i => `
                <div class="item-card expired">
                    <h3>${i.name}</h3>
                    <p>æ•°é‡: ${i.quantity} ${i.unit}</p>
                    <p>è¿‡æœŸ: ${i.expiration_date}</p>
                    <button class="btn btn-danger" onclick="deleteIngredient('${i.id}')">åˆ é™¤</button>
                </div>
            `).join('') || '<p>æš‚æ— å·²è¿‡æœŸé£Ÿæ</p>';

            document.getElementById('expiring-ingredients').innerHTML = expiring.map(i => `
                <div class="item-card expiring">
                    <h3>${i.name}</h3>
                    <p>æ•°é‡: ${i.quantity} ${i.unit}</p>
                    <p>è¿‡æœŸ: ${i.expiration_date}</p>
                    <button class="btn btn-secondary" onclick="deleteIngredient('${i.id}')">åˆ é™¤</button>
                </div>
            `).join('') || '<p>æš‚æ— å³å°†è¿‡æœŸé£Ÿæ</p>';
        }

        window.onload = () => {
            loadIngredients();
            loadRecipes();
        };
    </script>
</body>
</html>
